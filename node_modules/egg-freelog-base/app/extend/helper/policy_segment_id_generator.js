/**
 * Created by yuliang on 2017/8/30.
 */


'use strict'

const crypto = require('crypto')

/**
 * policy段落ID生成
 * @param policy
 */
module.exports = (policy) => {
    if (!Array.isArray(policy)) {
        throw new Error("policy must be Array")
    }

    return policy.map(policySegmentIdGenerate)
}


/**
 * 只针对license和payments部分进行签名
 * 因为签名的目的是为了防止同样的策略重复签订合约.故只针对合约所关心的执行问题进行签约
 * @param policySegment
 * @returns {*}
 */
const policySegmentIdGenerate = (policySegment) => {
    let targetObj = {
        license: policySegment.license,
        payments: policySegment.payments
    }

    let targetSignText = JSON.stringify(targetObj).replace(/\s/g, "").toLowerCase()

    policySegment.segmentId = crypto.createHash('md5').update(targetSignText).digest('hex')

    return policySegment
}