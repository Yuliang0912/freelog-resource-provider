'use strict'

const JsonSchemaValidator = require('jsonschema').Validator
const commonRegex = require('egg-freelog-base/app/extend/helper/common_regex')

module.exports = class CommonJsonSchema extends JsonSchemaValidator {

    constructor() {
        super()
        this.__initialCustomFormats__()
    }

    /**
     * 注册freelog默认的自定义格式
     * @returns {*}
     * @private
     */
    __initialCustomFormats__() {

        Object.entries(commonRegex).forEach(([key, value]) => {
            if (toString.call(value) === '[object RegExp]') {
                this.customFormats[key] = value.test.bind(value)
            }
        })
    }

    /**
     * 注册自定义格式校验函数
     * @param formatName
     * @param fn
     */
    registerCustomFormats(formatName, fn) {

        if (typeof formatName !== "string") {
            throw new Error("args[0] must be string")
        }
        if (typeof fn !== "function") {
            throw new Error("args[1] must be function")
        }

        this.customFormats[formatName] = fn
    }
}


