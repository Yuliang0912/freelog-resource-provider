/**
 * Created by yuliang on 2017/11/1.
 */

'use strict'

/**
 * 模拟本地身份认证中间件
 * @param app
 */
module.exports = (app) => async (ctx, next) => {

    ctx.request.identityInfo = ctx.request.identityInfo || {}

    let localIdentity = ctx.app.config.localIdentity

    if (!localIdentity) {
        await next()
        return
    }

    ctx.request.userId = localIdentity.userId
    ctx.request.identityInfo = {
        userInfo: localIdentity,
        tokenType: localIdentity.tokenType
    }

    await next()
}